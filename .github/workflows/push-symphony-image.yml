name: Build & Push Symphony API Image
on:
 push:
   branches:
     - feature/prebuild-containers-ghcr
     - main
 workflow_dispatch:
permissions:
 contents: read
 packages: write   # REQUIRED for GHCR push
jobs:
 build-and-push:
   runs-on: ubuntu-latest
   steps:
     - name: Checkout repository
       uses: actions/checkout@v4
       with:
          fetch-depth: 0
     # Required for ARM64 / multi-arch builds
     - name: Set up QEMU
       uses: docker/setup-qemu-action@v3
     - name: Set up Docker Buildx
       uses: docker/setup-buildx-action@v3
     # âœ… Use built-in GITHUB_TOKEN (recommended)
     - name: Login to GitHub Container Registry
       uses: docker/login-action@v3
       with:
         registry: ghcr.io
         username: ${{ github.actor }}
         password: ${{ secrets.TOKEN_GITHUB }}
     - name: Make push script executable
       run: chmod +x ./push-symphony-image.sh
     - name: Build & Push Symphony API Images
       env:
         USER_GITHUB: ${{ github.repository_owner }}
         TOKEN_GITHUB: ${{ secrets.TOKEN_GITHUB }}
       run: |
         ./push-symphony-image.sh